!function(){var a,b;a=function(){var a={};return a.getSessionStorage=function(){return window.sessionStorage},a}(),b=function(b){var c,d,e={},f="herment",g=100;return e.getServerName=function(){var a;return"undefined"!=typeof document.location&&"undefined"!=typeof document.location.hostname&&(a=document.location.hostname),""===a&&(a="-"),a},e.getProductNameFromServerName=function(a){return"undefined"!=typeof a?a.replace(".com","").replace(".net","").replace(".org","").replace(".au","").replace(".io",""):"-"},e.getSubdomain=function(a){var b="-",c=a.match(/^([a-z0-9\.]*)[\-\.]{1}([a-z0-9]+)+\.([a-z]{2,6})$/i);if(c){var d=a.split(".");d=2===d[d.length-1].length?d.slice(0,d.length-3):d.slice(0,d.length-2),0!==d.length&&(b=d.join("."))}return b},e.generateRandomStorageKey=function(){var a=2,b=12,c=(Math.random()+"").slice(a,b),d=(Math.random()+"").slice(a,b);return c.concat(d)},e.ajaxPost=function(a,b){var c;if(window.XMLHttpRequest)c=new XMLHttpRequest;else{if(!window.ActiveXObject)return;c=new window.ActiveXObject("Microsoft.XMLHTTP")}c.open("POST",a,!0),"undefined"!=typeof c.setRequestHeader&&(c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Accept","application/json, text/javascript, */*;")),c.send(b)},e.parseConfig=function(a,b){var c,d,e,h,i,j,k,l,m,n,o;if("undefined"==typeof a||"undefined"==typeof a.queue){var p=window.AJS=window.AJS||{};p.EventQueue=p.EventQueue||[],c=p.EventQueue}else c=a.queue;return d="undefined"==typeof a||"undefined"==typeof a.analyticsprotocol?"https":a.analyticsprotocol,e="undefined"==typeof a||"undefined"==typeof a.analyticsserver?"analytics.atlassian.com":a.analyticsserver,h="undefined"==typeof a||"undefined"==typeof a.analyticsurl?"/analytics/events":a.analyticsurl,i="undefined"==typeof a||"undefined"==typeof a.server?b.getServerName():a.server,j="undefined"==typeof a||"undefined"==typeof a.product?b.getProductNameFromServerName(i):a.product,"undefined"==typeof a||"undefined"==typeof a.subproduct?(k=b.getSubdomain(i),"undefined"==typeof k&&(k="-")):k=a.subproduct,l="undefined"==typeof a||"undefined"==typeof a.ajax?b.ajaxPost:a.ajax,m="undefined"==typeof a||"undefined"==typeof a.maxevents?g:a.maxevents,n="undefined"==typeof a||"undefined"==typeof a.storage_key?f+b.generateRandomStorageKey()+b.generateRandomStorageKey():a.storage_key,o="undefined"==typeof a||"undefined"==typeof a.user?"default":a.user,{queue:c,gasProtocol:d,gasServer:e,gasUrl:h,serverName:i,productName:j,subProductName:k,post:l,maxevents:m,storage_key:n,user:o}},c=e.parseConfig(b,e),e.config=c,d=a.getSessionStorage(),e.pushToServer=function(a,b){var d="undefined"!=typeof b?b:e.config.post,f=c.gasProtocol+"://"+c.gasServer+c.gasUrl,g={events:a},h=JSON.stringify(g);d(f,h)},e.addEventsToArray=function(a,b,c){if("undefined"!=typeof c&&"undefined"!=typeof c.server&&"undefined"!=typeof c.product&&"undefined"!=typeof c.subproduct&&"undefined"!=typeof c.user)for(var d in a)if(a.hasOwnProperty(d)){var f=a[d];if(b.length>=e.config.maxevents)break;if(f.name&&f.properties){var g={name:f.name,properties:f.properties,serverTime:f.time||(new Date).getTime(),server:c.server,user:c.user,product:c.product,subproduct:c.subproduct};b.push(g)}}},e.publishFromQueueAndStorage=function(a){var b="undefined"!=typeof a?a:e.pushToServer,f=[];if(!(c.queue.length<1&&("undefined"==typeof d||d.length<1))){var g={server:c.serverName,user:c.user,product:c.productName,subproduct:c.subProductName};e.addEventsToArray(c.queue,f,g);var h=e.popEventsFromStorage();e.addEventsToArray(h,f,g),c.queue.length=0,f&&f.length&&b(f)}},e.serialiseEventsToString=function(a){return JSON.stringify(a)},e.deserialiseEvents=function(a){return JSON.parse(a)},e.storeEvents=function(a){if("undefined"!=typeof d){if(d[c.storage_key]){var b=e.deserialiseEvents(d[c.storage_key])||[];b.length<e.config.maxevents&&b.push.apply(b,a),a=b}try{d.setItem(c.storage_key,e.serialiseEventsToString(a))}catch(f){}}},e.popEventsFromStorage=function(){if("undefined"==typeof d)return[];if(d[c.storage_key]){var a=e.deserialiseEvents(d[c.storage_key]);return d[c.storage_key]=e.serialiseEventsToString([]),a}return[]},e.moveQueueToStorage=function(){0!==c.queue.length&&"undefined"!=typeof d&&(e.storeEvents(c.queue),c.queue.length=0)},e.start=function(){var a=Array.prototype.push;c.queue.push=function(b){b.time=(new Date).getTime(),a.call(c.queue,b)},setInterval(e.publishFromQueueAndStorage,5e3),setInterval(e.moveQueueToStorage,1e3)},"undefined"==typeof window.onunload&&(window.onunload=function(){e.moveQueueToStorage()}),e},window["herment-gas-client"]=b,window.define&&window.define("herment",[],function(){return b})}();